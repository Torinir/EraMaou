;eraIM@Sから導入しました(eramaou)

;-------------------------------------------------
;調教者の射精チェック(アナルセックス)
;-------------------------------------------------
@COM_EJAC_PLAYER_ANALSEX
;獣姦の場合はそのまま終了
SIF TEQUIP:89
	RETURN 0

;コロシアムの場合は助手以外はここで終了
SIF TEQUIP:55 && (ASSI != PLAYER)
	RETURN 0

;調教者の射精ゲージ増加量
B = 0

;正常位アナル
IF SELECTCOM == 26
	;調教対象のABL:技巧をみる
	IF ABL:12 == 0
		B = 1500
	ELSEIF ABL:12 == 1
		B = 1600
	ELSEIF ABL:12 == 2
		B = 1800
	ELSEIF ABL:12 == 3
		B = 2000
	ELSEIF ABL:12 == 4
		B = 2400
	ELSE
		B = 3000
	ENDIF

	;調教対象のABL:従順をみる
	IF ABL:10 == 0
		TIMES B , 0.80
	ELSEIF ABL:10 == 1
		TIMES B , 0.90
	ELSEIF ABL:10 == 2
		TIMES B , 1.00
	ELSEIF ABL:10 == 3
		TIMES B , 1.10
	ELSEIF ABL:10 == 4
		TIMES B , 1.20
	ELSE
		TIMES B , 1.30
	ENDIF
;後背位アナル
ELSEIF SELECTCOM == 27
	;ABL:技巧をみる
	IF ABL:12 == 0
		B = 2700
	ELSEIF ABL:12 == 1
		B = 2800
	ELSEIF ABL:12 == 2
		B = 2900
	ELSEIF ABL:12 == 3
		B = 3100
	ELSEIF ABL:12 == 4
		B = 3200
	ELSE
		B = 3300
	ENDIF
;対面座位アナル
ELSEIF SELECTCOM == 28
	;ABL:技巧をみる
	IF ABL:12 == 0
		B = 800
	ELSEIF ABL:12 == 1
		B = 1000
	ELSEIF ABL:12 == 2
		B = 1200
	ELSEIF ABL:12 == 3
		B = 1400
	ELSEIF ABL:12 == 4
		B = 1600
	ELSE
		B = 1800
	ENDIF

	;ABL:従順をみる
	IF ABL:10 == 0
		TIMES B , 1.00
	ELSEIF ABL:10 == 1
		TIMES B , 1.30
	ELSEIF ABL:10 == 2
		TIMES B , 1.60
	ELSEIF ABL:10 == 3
		TIMES B , 1.90
	ELSEIF ABL:10 == 4
		TIMES B , 2.10
	ELSE
		TIMES B , 2.40
	ENDIF
;背面座位アナル
ELSEIF SELECTCOM == 29
	;ABL:技巧をみる
	IF ABL:12 == 0
		B = 900
	ELSEIF ABL:12 == 1
		B = 1100
	ELSEIF ABL:12 == 2
		B = 1300
	ELSEIF ABL:12 == 3
		B = 1500
	ELSEIF ABL:12 == 4
		B = 1700
	ELSE
		B = 1900
	ENDIF

	;ABL:従順をみる
	IF ABL:10 == 0
		TIMES B , 1.00
	ELSEIF ABL:10 == 1
		TIMES B , 1.10
	ELSEIF ABL:10 == 2
		TIMES B , 1.20
	ELSEIF ABL:10 == 3
		TIMES B , 1.30
	ELSEIF ABL:10 == 4
		TIMES B , 1.40
	ELSE
		TIMES B , 1.50
	ENDIF
;騎乗位アナル
ELSEIF SELECTCOM == 36
	;ABL:技巧をみる
	IF ABL:12 == 0
		B = 1000
	ELSEIF ABL:12 == 1
		B = 1300
	ELSEIF ABL:12 == 2
		B = 1700
	ELSEIF ABL:12 == 3
		B = 2200
	ELSEIF ABL:12 == 4
		B = 3000
	ELSE
		B = 4500
	ENDIF

	;ABL:従順をみる
	IF ABL:10 == 0
		TIMES B , 0.80
	ELSEIF ABL:10 == 1
		TIMES B , 0.90
	ELSEIF ABL:10 == 2
		TIMES B , 1.00
	ELSEIF ABL:10 == 3
		TIMES B , 1.10
	ELSEIF ABL:10 == 4
		TIMES B , 1.20
	ELSE
		TIMES B , 1.30
	ENDIF

	;ABL:奉仕技術をみる
	IF ABL:13 == 0
		TIMES B , 0.30
	ELSEIF ABL:13 == 1
		TIMES B , 0.70
	ELSEIF ABL:13 == 2
		TIMES B , 1.00
	ELSEIF ABL:13 == 3
		TIMES B , 1.20
	ELSEIF ABL:13 == 4
		TIMES B , 1.50
	ELSE
		TIMES B , 1.80
	ENDIF
ENDIF

;調教対象のABL:欲望をみる
IF ABL:11 == 0
	TIMES B , 1.00
ELSEIF ABL:11 == 1
	TIMES B , 1.10
ELSEIF ABL:11 == 2
	TIMES B , 1.20
ELSEIF ABL:11 == 3
	TIMES B , 1.30
ELSEIF ABL:11 == 4
	TIMES B , 1.40
ELSE
	TIMES B , 1.50
ENDIF

;ABL:性交技術をみる
IF ABL:14 == 0
	TIMES B , 1.00
ELSEIF ABL:14 == 1
	TIMES B , 1.10
ELSEIF ABL:14 == 2
	TIMES B , 1.20
ELSEIF ABL:14 == 3
	TIMES B , 1.30
ELSEIF ABL:14 == 4
	TIMES B , 1.40
ELSE
	TIMES B , 1.50
ENDIF

;PALAM:潤滑をみる
IF PALAM:3 < PALAMLV:1
	TIMES B , 0.40
ELSEIF PALAM:3 < PALAMLV:2
	TIMES B , 0.70
ELSEIF PALAM:3 < PALAMLV:3
	TIMES B , 1.00
ELSEIF PALAM:3 < PALAMLV:4
	TIMES B , 1.30
ELSEIF PALAM:3 >= PALAMLV:4
	TIMES B , 1.60
ENDIF

;プレイヤーのABL:Ｃ感覚をみる
IF ABL:PLAYER:0 == 0
	TIMES B , 1.00
ELSEIF ABL:PLAYER:0 == 1
	TIMES B , 1.50
ELSEIF ABL:PLAYER:0 == 2
	TIMES B , 2.00
ELSEIF ABL:PLAYER:0 == 3
	TIMES B , 2.50
ELSEIF ABL:PLAYER:0 == 4
	TIMES B , 3.50
ELSE
	TIMES B , 5.00
ENDIF

;EXP:A経験をみる
;A経験が多くなると少し下がる
IF EXP:1 < EXPLV:1
	TIMES B , 1.50
ELSEIF EXP:1 < EXPLV:2
	TIMES B , 1.00
ELSEIF EXP:1 < EXPLV:3
	TIMES B , 0.90
ELSEIF EXP:1 < EXPLV:4
	TIMES B , 0.80
ELSEIF EXP:1 < EXPLV:5
	TIMES B , 0.70
ELSE
	TIMES B , 0.60
ENDIF

;EXP:A拡張経験をみる
;A拡張経験が多くなるとかなり下がる
IF EXP:53 < EXPLV:1
	TIMES B , 1.00
ELSEIF EXP:53 < EXPLV:2
	TIMES B , 0.90
ELSEIF EXP:53 < EXPLV:3
	TIMES B , 0.70
ELSEIF EXP:53 < EXPLV:4
	TIMES B , 0.50
ELSEIF EXP:53 < EXPLV:5
	TIMES B , 0.30
ELSE
	TIMES B , 0.10
ENDIF

;コンドーム装着中だと下がる
IF TEQUIP:35 || (ASSIPLAY && TEQUIP:36 )
	TIMES B , 0.50
ENDIF

;射精ゲージ増加処理
SIF TALENT:PLAYER:121 || TALENT:PLAYER:122
	BASE:PLAYER:2 += B

;射精処理
S = BASE:PLAYER:2
EJAC = MAXBASE:PLAYER:2

IF  S > EJAC * 2
	E = 2
ELSEIF S > EJAC
	E = 1
ELSE
	E = 0
ENDIF

;大量射精
IF E == 2
	EXP:PLAYER:3 += 2
	EXP:20 += 1
	PRINTL High quantity ejaculation
	PRINTL Semen exp+1
	;Ｐに精液汚れ
	STAIN:PLAYER:2 |= 4

	BASE:PLAYER:2 -= EJAC*2
	SIF BASE:PLAYER:2 >= EJAC
		BASE:PLAYER:2 = EJAC-1

	;セックスで射精フラグ
	TFLAG:2 = 2
;通常の射精
ELSEIF E == 1
	EXP:PLAYER:3 += 1
	;Ｐに精液汚れ
	PRINTL Ejaculation
	STAIN:PLAYER:2 |= 4

	BASE:PLAYER:2 -= EJAC
	SIF BASE:PLAYER:2 >= EJAC
		BASE:PLAYER:2 = EJAC-1

	;セックスで射精フラグ
	TFLAG:2 = 1
ENDIF

;-------------------------------------------------
;アナルセックス後の処理
;-------------------------------------------------
@COM_AFTER_ANAL_SEX
;-------------------------------------------------
;経験上昇
;-------------------------------------------------
S = 0
;A感覚が高いほどA経験が入る
IF ABL:3 <= 1
	S += 3
ELSEIF ABL:3 <= 4
	S += 3
ELSEIF ABL:3 <= 7
	S += 4
ELSE
	S += 5
ENDIF
EXP:1 += S
PRINTFORML A経験+{S}
S = 0

EXP:5 += 1
PRINTL Sex exp+1

;獣姦の場合はここで終了
SIF TEQUIP:89
	RETURN 0

;女同士ならレズ経験上昇
IF TALENT:122 == 0 && TALENT:PLAYER:122 == 0
	PRINTS EXPNAME:40
	PRINTL +5
	EXP:40 += 5
;男同士ならホモ経験上昇
ELSEIF TALENT:122 == 1 && TALENT:PLAYER:122 == 1
	PRINTS EXPNAME:41
	PRINTL +7
	EXP:41 += 7
ENDIF

;コロシアムの場合はここで終了
SIF TEQUIP:55 && (ASSI != PLAYER)
	RETURN 0

;愛情経験
;正常位アナル
IF SELECTCOM == 26
	E = 3
;対面座位アナル
SIF SELECTCOM == 28
	E = 4
;その他
ELSE
	E = 2
ENDIF

;調教対象が男性なら+1
SIF TALENT:122
	E += 1

IF CFLAG:2 >= 1000 && ASSIPLAY == 0
	PRINTFORML %EXPNAME:23%+{E}
	EXP:23 += E
ENDIF
E = 0

;主人によるセックスなら好感度上昇
IF ASSIPLAY == 0
	IF ABL:3 >= 3
		TFLAG:30 += 2
	ELSE
		TFLAG:30 += 1
	ENDIF
ENDIF

;-------------------------------------------------
;汚れの処理
;-------------------------------------------------
;奴隷のA⇔調教者のＰの汚れが移動
STAIN:4 |= STAIN:PLAYER:2
STAIN:PLAYER:2 |= STAIN:4
;
;
;