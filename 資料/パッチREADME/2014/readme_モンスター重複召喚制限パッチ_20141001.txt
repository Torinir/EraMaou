----------------------------------------
はじめまして、こんにちは。
eramaou を楽しくプレイさせていただきました。


小さなパッチを作りました。
以下に説明を記します。


----------------------------------------
モンスターの重複召喚(出産)制限パッチ


簡単に説明すると、生まれ出るモンスターの種類を、
まだ最大数(99体)に達していない種類に限定するパッチです。

具体的には、以下の２つのファイルを変更しました。
・魔王様が、日の終わりに召喚するモンスター。(SUMMON_MONSTER.ERB)
・人間牧場施設において、肉便器から出産されるモンスター。(DUNGEON_ROOM.ERB)


コードでは、SUMMON_MONTER.ERB の最後尾に、
「現在のモンスターの総数を返す関数 (@MONSTER_TOTAL_COUNT) 」
と
「モンスター番号抽選関数 (@RAND_MONSTER_NUMBER) 」
を加えました。

そして、SUMMON_MONSTER.ERB 内のモンスター抽選部分と、
DUNGEON_ROOM.ERB 内のモンスター抽選部分から、
CALL RAND_MONSTER_NUMBER を実行するように改変しました。


モンスター番号抽選関数のロジックは、

生み出されるモンスター番号の抽選において、
「モンスターの総数が最大数(9*5*99=4455)でなく」
かつ
「抽選されたモンスターが既に最大数(99)」
の場合は、モンスター番号を抽選しなおします。

最初の条件の「モンスターの総数が最大数(9*5*99=4455)でなく」は、
この条件がないと、全てのモンスターが最大数(99)となった場合に、
無限ループに陥ってしまうためです。


テキストエディタの検索で簡単に見つかるように
ソースの改変部分には、「20141001」と記入しました。


----------------------------------------
コンフィグでオプション化すべきなのかとも考えましたが、
FLAG の割り当てがわからないので、実装はしていません。
RAND_MONSTER_NUMBER のコード内にコメントアウトして記しておきました。
必要なようでしたら、設定して下さい。


----------------------------------------
作者さんが、このパッチをお気に召された場合は、
本体に統合してくださって結構です。
むしろ、そうしていただけるとうれしいです。

コードの改変・複製などあらゆる行為を、
作者さん、またはそれ以外のどなたにでも許可します。
御自由になさって下さい。
